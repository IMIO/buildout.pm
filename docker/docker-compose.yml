version: '2.4'
services:
  libreoffice:
    image: imiobe/libreoffice:6.1
    command: soffice --headless --norestore --accept="socket,host=libreoffice,port=2002,tcpNoDelay=1;urp;StarOffice.ServiceManager"
    expose:
      - "2002"
    volumes:
      - tmp:/tmp
      - vartmp:/var/tmp
    networks:
      - libreoffice
    labels:
      SERVICE_NAME: "libreoffice"
    restart:
      unless-stopped
    mem_limit: 200M
    mem_reservation: 150M
  zeo:
    image: imiobe/iadelib:4.2.5
    command: zeoserver
    environment:
      - HOSTNAME_HOST=local
      - CUSTOM_TMP=/var/tmp
      - ADMIN_PASSWORD=admin
    volumes:
      - ./data/blobstorage:/data/blobstorage
      - ./data/filestorage:/data/filestorage
      - tmp:/tmp
      - vartmp:/var/tmp
    networks:
      - zeo
    labels:
      SERVICE_NAME: "zeo"
    restart:
      unless-stopped
  instance:
    image: imiobe/iadelib:4.2.5
    ports:
      - "20080:8081"
    networks:
      - zeo
      - libreoffice
    depends_on:
      - zeo
      - libreoffice
    environment:
      - ZEO_ADDRESS=zeo:8100
      - ZEO_CLIENT_CACHE_SIZE=1000MB
      - ZODB_CACHE_SIZE=100000
      - ADMIN_PASSWORD=admin
      - OO_SERVER=libreoffice
      - PUBLIC_URL=http://localhost/Plone
      - PLONE_PATH
      - MOUNTPOINT
    volumes:
      - tmp:/tmp
      - vartmp:/var/tmp
    labels:
      SERVICE_NAME: "instance"
    restart:
      unless-stopped

volumes:
  tmp:
  vartmp:

networks:
  zeo:
  libreoffice: